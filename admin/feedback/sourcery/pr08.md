# Sourcery Review Analysis
**PR**: #8
**Repository**: grimm00/dev-infra
**Generated**: Thu Nov 13 17:46:57 CST 2025

---

## Summary

Total Individual Comments: 2 + Overall Comments

## Individual Comments

### Comment #1

**Location**: `tests/new-project.bats:439-187`

**Type**: suggestion (testing)

**Description**: Consider adding a test case where gh CLI is installed but returns an unexpected error, to verify error handling in verify_github_auth.

<details>
<summary>Details</summary>

<b>Code Context</b>

<pre><code>
+# GitHub Authentication
+# ============================================================================
+
+@test &quot;github_auth: returns error when gh CLI not installed&quot; {
+    mock_gh &quot;not_installed&quot;
+    
+    run verify_github_auth &quot;testuser&quot;
+    [ &quot;$status&quot; -ne 0 ]
+}
+
</code></pre>

<b>Issue</b>

**suggestion (testing):** No test for fallback behavior if gh CLI is installed but fails unexpectedly.

</details>

---

### Comment #2

**Location**: `tests/new-project.bats:733-741`

**Type**: suggestion (testing)

**Description**: Add a test that triggers permission or read errors on the template directory to verify the script handles these cases and reports errors clearly.

<details>
<summary>Details</summary>

<b>Code Context</b>

<pre><code>
+    [ ! -d &quot;$templates_dir/regular-project&quot; ]
+}
+
+@test &quot;template_structure: both template types available&quot; {
+    # Test that both standard-project and learning-project templates exist
+    local git_root
+    git_root=$(git rev-parse --show-toplevel 2&gt;/dev/null || pwd)
+    local templates_dir=&quot;$git_root/templates&quot;
+    
+    [ -d &quot;$templates_dir/standard-project&quot; ]
+    [ -d &quot;$templates_dir/learning-project&quot; ]
+}
+
</code></pre>

<b>Issue</b>

**suggestion (testing):** No test for template directory permissions or read errors.

<b>Suggestion</b>

<pre><code>
@test &quot;template_structure: regular-project template no longer exists&quot; {
    # Test that old regular-project template is gone
    local git_root
    git_root=$(git rev-parse --show-toplevel 2&gt;/dev/null || pwd)
    local templates_dir=&quot;$git_root/templates&quot;

    # Verify regular-project does not exist
    [ ! -d &quot;$templates_dir/regular-project&quot; ]
}

@test &quot;template_structure: permission/read error on templates directory is handled&quot; {
    # Simulate permission error on templates directory
    local git_root
    git_root=$(git rev-parse --show-toplevel 2&gt;/dev/null || pwd)
    local templates_dir=&quot;$git_root/templates&quot;
    local restore_perms=&quot;&quot;

    if [ -d &quot;$templates_dir&quot; ]; then
        restore_perms=$(stat -c &quot;%a&quot; &quot;$templates_dir&quot;)
        chmod 000 &quot;$templates_dir&quot;
    fi

    run bash &quot;$git_root/new-project.sh&quot; standard-project test-project
    # Check for error message about permission/read error
    [[ &quot;$status&quot; -ne 0 ]]
    [[ &quot;$output&quot; =~ &quot;Error&quot; || &quot;$output&quot; =~ &quot;permission&quot; || &quot;$output&quot; =~ &quot;Permission denied&quot; ]]

    # Restore permissions
    if [ -n &quot;$restore_perms&quot; ]; then
        chmod &quot;$restore_perms&quot; &quot;$templates_dir&quot;
    fi
}
</code></pre>

</details>

---

## Overall Comments

- Consider splitting the monolithic new-project.bats into multiple behavior-focused test files (e.g., path expansion, directory validation, template operations) to improve readability and maintainability.
- Extract test-specific implementations (copy_template, customize_project, etc.) out of helpers.bash into a dedicated test fixture or mock library to avoid mixing production logic with test stubs.
- Refactor the mock_gh helper into a centralized, scenario-driven mock script to simplify GitHub CLI mocking and make it easier to extend test scenarios.

## Priority Matrix Assessment

| Comment | Priority | Impact | Effort | Notes |
|---------|----------|--------|--------|-------|
| #1 | ðŸŸ¡ MEDIUM | ðŸŸ¡ MEDIUM | ðŸŸ¢ LOW | Test for gh CLI unexpected errors - improves test coverage |
| #2 | ðŸŸ¡ MEDIUM | ðŸŸ¡ MEDIUM | ðŸŸ¡ MEDIUM | Test for template directory permissions - requires permission manipulation |
| Overall #1 | âœ… ADDRESSED | - | - | Split monolithic test file - completed in this PR |
| Overall #2 | ðŸŸ¡ MEDIUM | ðŸŸ¡ MEDIUM | ðŸŸ  HIGH | Extract test implementations - deferred to future work |
| Overall #3 | âœ… ADDRESSED | - | - | Refactor mock_gh - already improved in this PR |

### Priority Levels
- ðŸ”´ **CRITICAL**: Security, stability, or core functionality issues
- ðŸŸ  **HIGH**: Bug risks or significant maintainability issues
- ðŸŸ¡ **MEDIUM**: Code quality and maintainability improvements
- ðŸŸ¢ **LOW**: Nice-to-have improvements

### Impact Levels
- ðŸ”´ **CRITICAL**: Affects core functionality
- ðŸŸ  **HIGH**: User-facing or significant changes
- ðŸŸ¡ **MEDIUM**: Developer experience improvements
- ðŸŸ¢ **LOW**: Minor improvements

### Effort Levels
- ðŸŸ¢ **LOW**: Simple, quick changes
- ðŸŸ¡ **MEDIUM**: Moderate complexity
- ðŸŸ  **HIGH**: Complex refactoring
- ðŸ”´ **VERY_HIGH**: Major rewrites



