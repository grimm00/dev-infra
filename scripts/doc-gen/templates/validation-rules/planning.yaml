# Planning Document Validation Rules
# 
# Purpose: Define validation rules for planning documents
# Used by: dt-doc-validate CLI tool
# Reference: VALIDATION.md (Type-Specific Rules section)
#
# Document types covered:
#   - feature-plan.md (feature plan)
#   - phase.md (individual phase document)
#   - status-and-next-steps.md (progress tracking)
#   - README.md (feature hub)

---

# Feature Plan Document
feature_plan:
  description: "Feature plan validation rules"
  path_pattern: "admin/planning/features/*/feature-plan.md"
  
  common_rules:
    - rule_id: COMMON_STATUS_HEADER
      enabled: true
    - rule_id: COMMON_CREATED_DATE
      enabled: true
    - rule_id: COMMON_LAST_UPDATED
      enabled: true
    - rule_id: COMMON_STALE_DATE
      enabled: true
      threshold_days: 30
  
  required_sections:
    - section_id: overview
      pattern: "^## ğŸ“‹ Overview"
      error_code: MISSING_SECTION
      error_message: "Missing 'Overview' section"
      fix_suggestion: "Add '## ğŸ“‹ Overview' section after metadata block"
      
    - section_id: goals
      pattern: "^## ğŸ¯ Goals"
      error_code: MISSING_SECTION
      error_message: "Missing 'Goals' section"
      fix_suggestion: "Add '## ğŸ¯ Goals' section after Overview"
      
    - section_id: implementation_phases
      pattern: "^## ğŸ“… Implementation Phases"
      error_code: MISSING_SECTION
      error_message: "Missing 'Implementation Phases' section"
      fix_suggestion: "Add '## ğŸ“… Implementation Phases' section after Goals"
      
    - section_id: success_criteria
      pattern: "^## âœ… Success Criteria"
      error_code: MISSING_SECTION
      error_message: "Missing 'Success Criteria' section"
      fix_suggestion: "Add '## âœ… Success Criteria' section after Implementation Phases"
  
  optional_sections:
    - pattern: "^## ğŸ”— Dependencies"
      description: "Feature dependencies"
    - pattern: "^## ğŸš€ Next Steps"
      description: "Recommended next actions"
  
  examples:
    valid: |
      # Feature Plan: User Authentication
      
      **Status:** ğŸŸ  In Progress
      **Created:** 2026-01-16
      **Last Updated:** 2026-01-16
      
      ---
      
      ## ğŸ“‹ Overview
      
      Implement secure user authentication.
      
      ---
      
      ## ğŸ¯ Goals
      
      - Secure login/logout
      - Session management
      
      ---
      
      ## ğŸ“… Implementation Phases
      
      - Phase 1: Basic auth
      - Phase 2: OAuth integration
      
      ---
      
      ## âœ… Success Criteria
      
      - Users can log in securely

---

# Phase Document
phase:
  description: "Phase document validation rules"
  path_pattern: "admin/planning/features/*/phase-*.md"
  
  common_rules:
    - rule_id: COMMON_STATUS_HEADER
      enabled: true
    - rule_id: COMMON_CREATED_DATE
      enabled: true
    - rule_id: COMMON_LAST_UPDATED
      enabled: true
    - rule_id: COMMON_STALE_DATE
      enabled: true
      threshold_days: 14  # Phases should be updated frequently
  
  # Phase-specific metadata rules
  metadata_rules:
    - rule_id: PHASE_FEATURE_REF
      severity: WARNING
      pattern: "^\\*\\*Feature:\\*\\* "
      error_code: MISSING_FEATURE_REF
      error_message: "Missing 'Feature:' metadata field"
      fix_suggestion: "Add '**Feature:** [feature-name]' in metadata"
      
    - rule_id: PHASE_NUMBER
      severity: WARNING
      pattern: "^\\*\\*Phase:\\*\\* \\d+"
      error_code: MISSING_PHASE_NUMBER
      error_message: "Missing 'Phase:' metadata field"
      fix_suggestion: "Add '**Phase:** [number]' in metadata"
  
  required_sections:
    - section_id: goals
      pattern: "^## ğŸ¯ Goals"
      error_code: MISSING_SECTION
      error_message: "Missing 'Goals' section"
      fix_suggestion: "Add '## ğŸ¯ Goals' section after metadata"
      
    - section_id: tasks
      pattern: "^## ğŸ“ Tasks"
      error_code: MISSING_SECTION
      error_message: "Missing 'Tasks' section"
      fix_suggestion: "Add '## ğŸ“ Tasks' section after Goals"
      
    - section_id: completion_criteria
      pattern: "^## âœ… Completion Criteria"
      error_code: MISSING_SECTION
      error_message: "Missing 'Completion Criteria' section"
      fix_suggestion: "Add '## âœ… Completion Criteria' section after Tasks"
  
  optional_sections:
    - pattern: "^## ğŸ“¦ Deliverables"
      description: "Phase deliverables"
    - pattern: "^## ğŸ”— Dependencies"
      description: "Phase dependencies"
  
  # Scaffolding detection
  content_patterns:
    - pattern_id: scaffolding_marker
      pattern: "âš ï¸ \\*\\*Scaffolding:\\*\\*"
      severity: INFO
      error_message: "Phase contains scaffolding - run --expand to add detailed tasks"
      fix_suggestion: "Run '/transition-plan [feature] --expand --phase N' to expand"

---

# Status and Next Steps Document
status_and_next_steps:
  description: "Status and next steps validation rules"
  path_pattern: "admin/planning/features/*/status-and-next-steps.md"
  
  common_rules:
    - rule_id: COMMON_STATUS_HEADER
      enabled: true
    - rule_id: COMMON_LAST_UPDATED
      enabled: true
    - rule_id: COMMON_STALE_DATE
      enabled: true
      threshold_days: 7  # Status should be updated frequently
  
  required_sections:
    - section_id: progress_overview
      pattern: "^## ğŸ“Š Progress Overview"
      error_code: MISSING_SECTION
      error_message: "Missing 'Progress Overview' section"
      fix_suggestion: "Add '## ğŸ“Š Progress Overview' section with phase status table"
      
    - section_id: next_steps
      pattern: "^## ğŸš€ Next Steps"
      error_code: MISSING_SECTION
      error_message: "Missing 'Next Steps' section"
      fix_suggestion: "Add '## ğŸš€ Next Steps' section"
  
  optional_sections:
    - pattern: "^## ğŸ”„ Phase Progress"
      description: "Detailed phase progress"
  
  # Progress table validation
  content_patterns:
    - pattern_id: progress_table
      pattern: "\\| Phase \\| Name \\| Status \\|"
      severity: WARNING
      error_message: "Missing progress tracking table"
      fix_suggestion: "Add progress table with columns: Phase, Name, Status, Progress, Notes"

---

# Planning Hub (README.md)
planning_hub:
  description: "Feature hub (README.md) validation rules"
  path_pattern: "admin/planning/features/*/README.md"
  
  common_rules:
    - rule_id: COMMON_STATUS_HEADER
      enabled: true
    - rule_id: COMMON_CREATED_DATE
      enabled: true
    - rule_id: COMMON_LAST_UPDATED
      enabled: true
    - rule_id: COMMON_STALE_DATE
      enabled: true
      threshold_days: 14
  
  required_sections:
    - section_id: quick_links
      pattern: "^## ğŸ“‹ Quick Links"
      error_code: MISSING_SECTION
      error_message: "Missing 'Quick Links' section"
      fix_suggestion: "Add '## ğŸ“‹ Quick Links' section after metadata"
      
    - section_id: overview
      pattern: "^## ğŸ¯ Overview"
      error_code: MISSING_SECTION
      error_message: "Missing 'Overview' section"
      fix_suggestion: "Add '## ğŸ¯ Overview' section after Quick Links"
  
  optional_sections:
    - pattern: "^## ğŸ“Š Phase Status"
      description: "Status table of phases"
    - pattern: "^## âœ… Success Criteria"
      description: "Feature success criteria"
    - pattern: "^## ğŸš€ Next Steps"
      description: "Recommended next actions"

---

# Phase Status Values
status_values:
  description: "Valid planning status values for validation"
  valid_statuses:
    - value: "ğŸ”´ Not Started"
      description: "Work not yet begun"
    - value: "ğŸŸ  In Progress"
      description: "Work currently active"
    - value: "ğŸŸ¡ Blocked"
      description: "Work blocked by dependencies"
    - value: "âœ… Complete"
      description: "Work completed"
    - value: "â¸ï¸ Paused"
      description: "Work temporarily paused"
    - value: "âŒ Cancelled"
      description: "Work cancelled"
